---
- name: Compile yarn template
  template:
      src: yarn-site.xml
      dest: "{{ hadoop_home }}/etc/hadoop/yarn-site.xml"
      owner: root
      group: root
  notify:
   - restart hadoop-dfs
   - restart yarn-resourcemanager
   - restart hadoop-datanode
   - restart yarn-nodemanager

- name: Compile hdfs template
  template:
      src: hdfs-site.xml
      dest: "{{ hadoop_home }}/etc/hadoop/hdfs-site.xml"
      owner: root
      group: root
  notify:
   - restart hadoop-dfs
   - restart yarn-resourcemanager
   - restart hadoop-datanode
   - restart yarn-nodemanager

- name: Compile core template
  template:
      src: core-site.xml
      dest: "{{ hadoop_home }}/etc/hadoop/core-site.xml"
      owner: root
      group: root
  notify:
   - restart hadoop-dfs
   - restart yarn-resourcemanager
   - restart hadoop-datanode
   - restart yarn-nodemanager

- name: Compile slaves template
  template:
      src: slaves
      dest: "{{ hadoop_home }}/etc/hadoop/slaves"
      owner: root
      group: root
  notify:
   - refreshDFSNodes
   - refreshYarnNodes
   - restart hadoop-datanode
   - restart yarn-nodemanager

- name: Run hdfs
  command: "{{ hadoop_home }}/bin/hdfs namenode -format creates=/tmp/hadoop-root/dfs/name"
  when: (hadoop_node_type == 'master') or (hadoop_node_type == 'namenode')
