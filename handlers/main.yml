# Hadoop 3.x.y
- name: Hadoop {{ hadoop_version }} restart hadoop-dfs
  block:
    shell: "{{ hadoop_home }}/bin/hdfs --daemon stop namenode; {{ hadoop_home }}/bin/hdfs --daemon start namenode"
    when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'namenode' )
  when: hadoop_version[0] == '3'
  
- name: Hadoop {{ hadoop_version }} restart yarn-resourcemanager
  block:
    shell: "{{ hadoop_home }}/bin/yarn --daemon stop resourcemanager; {{ hadoop_home }}/bin/yarn --daemon start resourcemanager"
    when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'resourcemanager' )
  when: hadoop_version[0] == '3'
   
- name: Hadoop {{ hadoop_version }} restart hadoop-datanode
  block:
    shell: "{{ hadoop_home }}/bin/hdfs --daemon stop datanode; {{ hadoop_home }}/bin/hdfs --daemon start datanode"
    when: ( hadoop_type_of_node == 'slave' ) or ( hadoop_type_of_node == 'datanode' )
  when: hadoop_version[0] == '3'
  
- name: Hadoop {{ hadoop_version }} restart yarn-nodemanager
  block:
    shell: "{{ hadoop_home }}/bin/yarn --daemon stop nodemanager; {{ hadoop_home }}/bin/yarn --daemon start nodemanager"
    when: ( hadoop_type_of_node == 'slave' ) or ( hadoop_type_of_node == 'nodemanager' )
  when: hadoop_version[0] == '3'

# Hadoop 2.x.y
- name: Hadoop {{ hadoop_version }} restart hadoop-dfs
  block:
    shell: "{{ hadoop_home }}/sbin/hadoop-daemon.sh  --script hdfs stop namenode; {{ hadoop_home }}/sbin/hadoop-daemon.sh  --script hdfs start namenode"
    when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'namenode' )
  when: hadoop_version[0] == '2'
  
- name: Hadoop {{ hadoop_version }} restart yarn-resourcemanager
  block:
    shell: "{{ hadoop_home }}/sbin/yarn-daemon.sh stop resourcemanager; {{ hadoop_home }}/sbin/yarn-daemon.sh start resourcemanager"
    when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'resourcemanager' )
  when: hadoop_version[0] == '2'
   
- name: Hadoop {{ hadoop_version }} restart hadoop-datanode
  block:
    shell: "{{ hadoop_home }}/sbin/hadoop-daemon.sh  --script hdfs stop datanode; {{ hadoop_home }}/sbin/hadoop-daemon.sh  --script hdfs start datanode"
    when: ( hadoop_type_of_node == 'slave' ) or ( hadoop_type_of_node == 'datanode' )
  when: hadoop_version[0] == '2'
  
- name: Hadoop {{ hadoop_version }} restart yarn-nodemanager
  block:
    shell: "{{ hadoop_home }}/sbin/yarn-daemon.sh stop nodemanager; {{ hadoop_home }}/sbin/yarn-daemon.sh start nodemanager"
    when: ( hadoop_type_of_node == 'slave' ) or ( hadoop_type_of_node == 'nodemanager' )
  when: hadoop_version[0] == '2'
  
- name: refreshDFSNodes
  command: "{{ hadoop_home }}/bin/hdfs dfsadmin -refreshNodes"
  when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'namenode' )
  ignore_errors: yes

- name: refreshYarnNodes
  command: "{{ hadoop_home }}/bin/yarn rmadmin -refreshNodes"
  when: ( hadoop_type_of_node == 'master' ) or ( hadoop_type_of_node == 'resourcemanager' )
  ignore_errors: yes
